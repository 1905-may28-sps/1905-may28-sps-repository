--Creation of ERS_User_Roles table
CREATE TABLE ERS_USER_ROLES(
ERS_USER_ROLEID NUMBER PRIMARY KEY,
USER_ROLE VARCHAR2(10)
);

--Creation of ERS_Reimbursement table
CREATE TABLE ERS_REIMBURSEMENT_TYPE(
REIMB_TYPE_ID NUMBER PRIMARY KEY,
REIMB_TYPE VARCHAR2(10)
);

--Creation of ERS_reimbursement_status table 
CREATE TABLE ERS_REIMBURSEMENT_STATUS(
REIMB_STATUS_ID NUMBER PRIMARY KEY,
REIMB_STATUS VARCHAR2(10)
);

--Cretaion of ESR_users table, sequence and trigger
--Correct Order of columns.
CREATE TABLE ERS_USERS(
USER_ID NUMBER PRIMARY KEY,
FIRSTNAME VARCHAR2(100) NOT NULL,
LASTNAME VARCHAR2(100) NOT NULL,
EMAIL VARCHAR2(150) NOT NULL UNIQUE,
USERNAME VARCHAR2(50) UNIQUE,
PASSWORD VARCHAR2(50) NOT NULL,
USER_ROLE_ID NUMBER NOT NULL,
FOREIGN KEY (USER_ROLE_ID) REFERENCES ERS_USER_ROLES(ERS_USER_ROLEID)
);

CREATE SEQUENCE USERID_SEQ;

CREATE TRIGGER USERID_Trigger
BEFORE INSERT ON ERS_USERS
FOR EACH ROW
BEGIN
   SELECT USERID_SEQ.NEXTVAL
   INTO :NEW.USER_ID
   FROM DUAL;
END;
/

--Cretaion of ESR_users table, sequence and trigger
CREATE TABLE ERS_REIMBURSEMENT(
REIMB_ID NUMBER PRIMARY KEY,
REIMB_AMOUNT NUMBER(8,2) NOT NULL,
REIMB_SUBMITTED TIMESTAMP,
REIMB_RESOLVED TIMESTAMP,
REIMB_DESCRIPTION VARCHAR2(250),
REIMB_RECEIPT BLOB,
REIMB_AUTHOR NUMBER NOT NULL,
FOREIGN KEY (REIMB_AUTHOR) REFERENCES ERS_USERS (USER_ID),
REIMB_RESOLVER NUMBER NOT NULL,
FOREIGN KEY (REIMB_RESOLVER) REFERENCES ERS_USERS (USER_ID),
REIMB_STATUS_ID NUMBER NOT NULL,
FOREIGN KEY (REIMB_STATUS_ID) REFERENCES ERS_REIMBURSEMENT_STATUS (REIMB_STATUS_ID),
REIMB_TYPE_ID NUMBER NOT NULL,
FOREIGN KEY (REIMB_TYPE_ID) REFERENCES ERS_REIMBURSEMENT_TYPE (REIMB_TYPE_ID)
);

CREATE SEQUENCE REIMBID_SEQ;

CREATE TRIGGER REIMBID_Trigger
BEFORE INSERT ON ERS_REIMBURSEMENT
FOR EACH ROW
BEGIN
   SELECT REIMBID_SEQ.NEXTVAL
   INTO :NEW.REIMB_ID
   FROM DUAL;
END;
/
COMMIT;

SELECT REIMBID_SEQ.NEXTVAL FROM DUAL
 SELECT REIMBID_SEQ.CURRVAL FROM DUAL

INSERT INTO ERS_USER_ROLES (ERS_USER_ROLEID, USER_ROLE) VALUES (1,'Employee');
INSERT INTO ERS_USER_ROLES (ERS_USER_ROLEID, USER_ROLE) VALUES (2,'Manager');
COMMIT;

INSERT INTO ERS_REIMBURSEMENT_TYPE (REIMB_TYPE_ID, REIMB_TYPE) VALUES (1, 'Lodging');
INSERT INTO ERS_REIMBURSEMENT_TYPE (REIMB_TYPE_ID, REIMB_TYPE) VALUES (2, 'Food');
INSERT INTO ERS_REIMBURSEMENT_TYPE (REIMB_TYPE_ID, REIMB_TYPE) VALUES (3, 'Travel');
INSERT INTO ERS_REIMBURSEMENT_TYPE (REIMB_TYPE_ID, REIMB_TYPE) VALUES (4, 'Other');
SELECT * FROM ERS_REIMBURSEMENT_TYPE;
COMMIT;

INSERT INTO ERS_REIMBURSEMENT_STATUS (REIMB_STATUS_ID, REIMB_TYPE) VALUES (1, 'Pending');
INSERT INTO ERS_REIMBURSEMENT_STATUS (REIMB_STATUS_ID, REIMB_TYPE) VALUES (2, 'Approved');
INSERT INTO ERS_REIMBURSEMENT_STATUS (REIMB_STATUS_ID, REIMB_TYPE) VALUES (3, 'Denied');
SELECT * FROM ERS_REIMBURSEMENT_STATUS;
commit;

INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Viji','Laxman', 'plviji@hotmail.com', 'plviji', 'viji12', 1);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Anil','Kumar', 'anilk@hotmail.com', 'anil12', 'kumar1', 2);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Billy','clara', 'billiy2@hotmail.com', 'billy3', 'clara1', 1);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Jason','Lo', 'jason@gmail.com', 'jason1', 'jlo2', 2);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Nico','Sta', 'nicko12@hotmail.com', 'nico1', 'sta12', 2);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Kemi','Olu', 'kemi@hotmail.com', 'kemi1', 'olu12', 1);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Tiffany','Tiff', 'tiffany@yahoo.com', 'tiffany', 'tiffany12', 1);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Genesis','Bonds', 'gbonds@hotmail.com', 'gen', 'gen12', 2);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Adam','Thomas', 'tadam@hotmail.com', 'adam', 'tom12', 2);
INSERT INTO ERS_USERS (FIRSTNAME, LASTNAME, EMAIL, USERNAME, PASSWORD, USER_ROLE_ID) VALUES
('Andrew','Williams', 'wandrew@gmail.com', 'and', 'and12', 2);
commit;

SELECT firstname, lastname, email, username, password, user_id FROM ERS_USERS;
COMMIT;

SELECT * FROM ERS_USERS;

INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (4500, SYSDATE, SYSDATE,'Travel Allowance',21, 22, 1, 1);

INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (4500, SYSDATE, SYSDATE,'Travel Allowance',23, 22, 2, 1);

INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (4500, SYSDATE, SYSDATE,'Dinner',24, 22, 1, 2);

INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (4500, SYSDATE, SYSDATE,'Miscellaneous',25, 27, 1, 4);


INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (908.99, SYSDATE, SYSDATE,'Food',21, 22, 2, 2);

COMMIT;

SELECT * FROM ERS_REIMBURSEMENT;

SELECT * FROM ERS_USERS;

SELECT * FROM ERS_USERS WHERE USERNAME = 'kemi1';


SELECT U.USER_ID, U.FIRSTNAME, U.LASTNAME, R.REIMB_AMOUNT, R.REIMB_ID, R.REIMB_SUBMITTED, R.REIMB_RESOLVED, RS.REIMB_STATUS
FROM ERS_REIMBURSEMENT R 
INNER JOIN ERS_USERS U ON R.REIMB_AUTHOR = U.USER_ID
INNER JOIN ERS_REIMBURSEMENT_STATUS RS ON R.REIMB_STATUS_ID = RS.REIMB_STATUS_ID
WHERE USERNAME = 'plviji';

INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (908.99, SYSDATE, SYSDATE,'Food',21, 22, 2, 2);
commit;

SELECT * FROM ERS_REIMBURSEMENT;

INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (1350.59, SYSDATE, SYSDATE,'Room Rent',21, 22, 2, 1);

INSERT INTO ERS_REIMBURSEMENT 
(REIMB_AMOUNT, REIMB_SUBMITTED, REIMB_RESOLVED, REIMB_DESCRIPTION, 
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)
VALUES (1350.59, SYSDATE, SYSDATE,'Travel form NY to VA',21, 22, 2, 3);
commit;

INSERT INTO ERS_REIMBURSEMENT
(REIMB_AMOUNT, REIMB_TYPE_ID, REIMB_DESCRIPTION, REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID)
VALUES (1289.45, 1, 'Gas and Food', 21, 22, 1);

SELECT U.USER_ID, U.FIRSTNAME, U.LASTNAME, R.REIMB_AMOUNT, R.REIMB_ID, R.REIMB_SUBMITTED, R.REIMB_RESOLVED, RS.REIMB_STATUS
FROM ERS_REIMBURSEMENT R 
INNER JOIN ERS_USERS U ON R.REIMB_AUTHOR = U.USER_ID
INNER JOIN ERS_REIMBURSEMENT_STATUS RS ON R.REIMB_STATUS_ID = RS.REIMB_STATUS_ID
WHERE USERNAME = 'plviji';

select * from ERS_USERS;
UPDATE ERS_REIMBURSEMENT SET REIMB_STATUS_ID = 3, REIMB_RESOLVED = CURRENT_TIMESTAMP, REIMB_RESOLVER = 22 WHERE REIMB_ID = 6;


SELECT U.USER_ID, U.FIRSTNAME, U.LASTNAME, R.REIMB_AMOUNT, R.REIMB_ID, R.REIMB_SUBMITTED, 
R.REIMB_RESOLVED, R.REIMB_RESOLVER, RS.REIMB_STATUS
FROM ERS_REIMBURSEMENT R 
INNER JOIN ERS_USERS U ON R.REIMB_AUTHOR = U.USER_ID
INNER JOIN ERS_REIMBURSEMENT_STATUS RS ON R.REIMB_STATUS_ID = RS.REIMB_STATUS_ID
WHERE USERNAME = 'plviji';

COMMIT;
--Query for listing all employee's reimbursements,
SELECT U.USER_ID, U.FIRSTNAME, U.LASTNAME, R.REIMB_ID, R.REIMB_AMOUNT,  R.REIMB_SUBMITTED, 
R.REIMB_RESOLVED, R.REIMB_RESOLVER, RS.REIMB_STATUS
FROM ERS_REIMBURSEMENT R 
INNER JOIN ERS_USERS U ON R.REIMB_AUTHOR = U.USER_ID
INNER JOIN ERS_REIMBURSEMENT_STATUS RS ON R.REIMB_STATUS_ID = RS.REIMB_STATUS_ID;

commit;

SELECT * FROM ERS_USERS ;

SELECT * FROM ERS_REIMBURSEMENT;

SELECT U.USER_ID, U.FIRSTNAME, U.LASTNAME R.REIMB_ID, R.REIMB_AMOUNT
FROM ERS_USERS U INNER JOIN ERS_REIMBURSEMENT R ON
U.


SELECT U.USER_ID, U.FIRSTNAME, U.LASTNAME, R.REIMB_AMOUNT, R.REIMB_ID, R.REIMB_SUBMITTED, 
R.REIMB_RESOLVED, R.REIMB_RESOLVER, RS.REIMB_STATUS
FROM ERS_REIMBURSEMENT R 
INNER JOIN ERS_USERS U ON R.REIMB_AUTHOR = U.USER_ID
INNER JOIN ERS_REIMBURSEMENT_STATUS RS ON R.REIMB_STATUS_ID = RS.REIMB_STATUS_ID
WHERE USERNAME = 'anil12';

UPDATE ERS_REIMBURSEMENT SET  
REIMB_RESOLVED = CURRENT_TIMESTAMP, REIMB_STATUS_ID = 2, REIMB_RESOLVER = 22 WHERE REIMB_ID = 8;

INSERT INTO ERS_REIMBURSEMENT  (REIMB_SUBMITTED, REIMB_AMOUNT, REIMB_DESCRIPTION,  
REIMB_AUTHOR, REIMB_RESOLVER, REIMB_STATUS_ID, REIMB_TYPE_ID)  VALUES (sysdate, 50, 'tESTING BY VIJI', 21,22, 2, 1);

UPDATE ERS_REIMBURSEMENT SET  
REIMB_STATUS_ID = 2, REIMB_RESOLVED = SYSDATE
WHERE REIMB_ID = 134;

select * from ers_reimbursement;

CREATE OR REPLACE PROCEDURE UPDATE_STATUS
  (p_STATUS_ID IN NUMBER,p_REIMB_ID IN NUMBER)
AS
BEGIN
   UPDATE ERS_REIMBURSEMENT SET
   REIMB_STATUS_ID = p_STATUS_ID,
   REIMB_RESOLVED = CURRENT_TIMESTAMP
   WHERE   REIMB_ID = p_REIMB_ID;
  COMMIT;
END;
/
EXEC UPDATE_STATUS (2, 155);

select * from ers_reimbursement where REIMB_ID = 155;



UPDATE ERS_REIMBURSEMENT SET
   STATUS_ID = 2   
   WHERE   REIMB_ID = 145;
   
DELETE FROM ERS_REIMBURSEMENT WHERE REIMB_ID =61 ; 
COMMIT;
SELECT * FROM ERS_REIMBURSEMENT;
